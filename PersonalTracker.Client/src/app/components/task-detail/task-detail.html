<mat-toolbar color="primary" class="detail-toolbar">

  <button mat-stroked-button class="calendar-btn" (click)="goBack()">
    <mat-icon>arrow_back</mat-icon>
    Takvim Görünümü
  </button>

<!--  <span class="toolbar-title">Görev Detayları</span>-->

  <span class="spacer"></span>

  <button mat-icon-button (click)="toggleViewMode()"
          [matTooltip]="isGridView ? 'Liste Görünümü' : 'Kart Görünümü'">
    <mat-icon>{{ isGridView ? 'list' : 'grid_view' }}</mat-icon>
  </button>

  <button mat-stroked-button
          color="accent"
          (click)="saveChanges()"
          [disabled]="isSaving">
    <mat-icon>save</mat-icon>
    {{ isSaving ? 'Kaydediliyor...' : 'Kaydet' }}
  </button>

</mat-toolbar>

<div class="content-container">
</div>
<div *ngIf="selectedTask" class="detail-container">

<!--  <div class="top-actions" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">-->

<!--    <h2 style="margin:0; color:#444;">-->
<!--      {{ isGridView ? 'Not Geçmişi (Galeri)' : 'Görev Düzenle' }}-->
<!--    </h2>-->

<!--    <button mat-stroked-button (click)="toggleViewMode()" color="primary">-->
<!--      <mat-icon>{{ isGridView ? 'edit_note' : 'grid_view' }}</mat-icon>-->
<!--      {{ isGridView ? 'Düzenleme Moduna Dön' : 'Notları Kart Olarak Gör' }}-->
<!--    </button>-->
<!--  </div>-->

  <ng-container *ngIf="!isGridView">

    <div class="split-container">

      <div class="left-panel">
        <div class="master-card">

          <div class="header-row-container">
            <mat-form-field appearance="outline" class="header-field" subscriptSizing="dynamic">
              <mat-label>Görev Başlığı</mat-label>
              <input matInput [(ngModel)]="selectedTask.header" style="font-weight: bold; font-size: 1.2em;">
            </mat-form-field>

            <mat-checkbox [(ngModel)]="selectedTask.isCompleted" color="primary" class="status-checkbox">
              Tamamlandı
            </mat-checkbox>
          </div>

          <div class="master-row-split">
            <mat-form-field appearance="outline" subscriptSizing="dynamic" class="date-field">
              <mat-label>Tarih Aralığı</mat-label>
              <mat-date-range-input [rangePicker]="picker">
                <input matStartDate [(ngModel)]="selectedTask.startDate" placeholder="Başlangıç">
                <input matEndDate [(ngModel)]="selectedTask.endDate" placeholder="Bitiş">
              </mat-date-range-input>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </div>

          <div class="master-row">
            <mat-form-field appearance="outline" style="width: 100%;" subscriptSizing="dynamic">
              <mat-label>Açıklama / Liste</mat-label>

              <textarea matInput
                        [(ngModel)]="selectedTask.body"
                        rows="3"
                        (keydown)="handleEnter($event, selectedTask, 'body')"
                        (click)="toggleCheckbox($event, selectedTask, 'body')"
                        placeholder="Yazmaya başla..."></textarea>

              <button mat-icon-button matSuffix (click)="addCheckbox(selectedTask, 'body')" matTooltip="Listeye Çevir">
                <mat-icon>checklist</mat-icon>
              </button>
            </mat-form-field>
          </div>

        </div>

        <div style="margin-top: 30px;">
          <app-task-charts
            [currentTask]="selectedTask"
            [allTasks]="allTasks"
            [showTrend]="false"
            [showSummary]="true">
          </app-task-charts>
        </div>

      </div>

      <div class="right-panel">
        <h3>Günlük Çalışma Kayıtları</h3>

        <div class="logs-scroll-container">
          <div *ngFor="let log of selectedTask.logs" class="log-card">

            <div class="log-date">
              <span style="font-size: 1.1em;">{{ log.logTime | date:'dd' }}</span>
              <small>{{ log.logTime | date:'MMM' }}</small> <br>
              <small style="opacity: 0.8;">{{ log.logTime | date:'EEE' }}</small>
            </div>

            <div class="log-description" style="position: relative;">
              <textarea
                [(ngModel)]="log.description"
                (keydown)="handleEnter($event, log, 'description')"
                (click)="toggleCheckbox($event, log, 'description')"
                placeholder="Notlar..."
                class="desc-input"
                rows="3"></textarea>

              <button class="mini-list-btn" (click)="addCheckbox(log, 'description')" title="Listeye Çevir">
                <mat-icon style="font-size: 18px; height: 18px; width: 18px;">checklist</mat-icon>
              </button>
            </div>

            <div class="log-hours">
              <label>Saat:</label>
              <input type="number"
                     [(ngModel)]="log.hoursSpent"
                     min="0" step="0.5"
                     class="hour-input">
            </div>

          </div>
        </div>

<!--        <div class="actions" style="margin-top: 20px; text-align: right;">-->
<!--          <button mat-raised-button-->
<!--                  color="primary"-->
<!--                  (click)="saveChanges()"-->
<!--                  [disabled]="isSaving">-->
<!--            {{ isSaving ? 'Kaydediliyor...' : 'Değişiklikleri Kaydet' }}-->
<!--          </button>-->
<!--        </div>-->
      </div>

    </div>

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

    <app-task-charts
      [currentTask]="selectedTask"
      [allTasks]="allTasks"
      [showTrend]="true"
      [showSummary]="false">
    </app-task-charts>

  </ng-container>

  <app-task-log-gallery
    *ngIf="isGridView"
    [logs]="selectedTask.logs ?? []">
  </app-task-log-gallery>

</div>

<div *ngIf="!selectedTask" class="empty-state">
  <p>Detaylarını görmek için soldaki listeden bir görev seçin.</p>
</div>
